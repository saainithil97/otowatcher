<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üñºÔ∏è Gallery - Aquarium Timelapse</title>
    
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.24/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    
    <style>
        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .gallery-item {
            transition: transform 0.2s ease;
        }
        
        .gallery-item:hover {
            transform: scale(1.05);
            z-index: 10;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 min-h-screen">
    <!-- Navbar -->
    <div class="navbar glass-effect text-white mb-8 sticky top-0 z-50">
        <div class="flex-1">
            <a href="/" class="btn btn-ghost text-xl">
                <i class="fas fa-fish"></i>
                Aquarium Timelapse
            </a>
        </div>
        <div class="flex-none gap-2">
            <a href="/" class="btn btn-ghost">
                <i class="fas fa-home"></i>
                Home
            </a>
        </div>
    </div>

    <div class="container mx-auto px-4 pb-8 max-w-7xl">
        <div class="card glass-effect shadow-2xl">
            <div class="card-body">
                <h2 class="card-title text-white text-3xl mb-6">
                    <i class="fas fa-images"></i>
                    Recent Captures
                    <span class="badge badge-primary">{{ images|length }} images</span>
                </h2>
                
                {% if images %}
                <!-- Gallery Grid -->
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    {% for img in images %}
                    <div class="gallery-item card bg-base-300 shadow-xl cursor-pointer" 
                         onclick="openModal('{{ img.path }}', '{{ img.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}', '{{ img.size_mb }}')">
                        <figure class="aspect-video">
                            <img src="/image/{{ img.path }}" 
                                 alt="{{ img.filename }}"
                                 class="w-full h-full object-cover"
                                 loading="lazy">
                        </figure>
                        <div class="card-body p-3">
                            <p class="text-xs text-white/70">
                                <i class="fas fa-clock"></i>
                                {{ img.timestamp.strftime('%H:%M:%S') }}
                            </p>
                            <p class="text-xs text-white/50">
                                {{ img.timestamp.strftime('%b %d, %Y') }}
                            </p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-12 text-white/50">
                    <i class="fas fa-camera text-6xl mb-4"></i>
                    <p>No images found</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Modal for full-size image -->
    <dialog id="image-modal" class="modal">
        <div class="modal-box w-11/12 max-w-5xl glass-effect">
            <form method="dialog">
                <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">‚úï</button>
            </form>
            <h3 class="font-bold text-lg text-white mb-4" id="modal-title">Image Details</h3>
            <img id="modal-image" src="" alt="Full size" class="w-full rounded-lg">
            <div class="mt-4 flex gap-2 flex-wrap">
                <button onclick="downloadModalImage()" class="btn btn-primary btn-sm">
                    <i class="fas fa-download"></i>
                    Download
                </button>
                <div id="modal-info" class="badge badge-outline"></div>
            </div>
        </div>
        <form method="dialog" class="modal-backdrop">
            <button>close</button>
        </form>
    </dialog>

    <script>
        let currentImagePath = '';
        
        function openModal(path, timestamp, size) {
            currentImagePath = path;
            const modal = document.getElementById('image-modal');
            const img = document.getElementById('modal-image');
            const title = document.getElementById('modal-title');
            const info = document.getElementById('modal-info');
            
            img.src = '/image/' + path;
            title.textContent = timestamp;
            info.textContent = size + ' MB';
            
            modal.showModal();
        }
        
        function downloadModalImage() {
            window.open('/image/' + currentImagePath, '_blank');
        }
        
        // Load saved theme
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
    </script>
</body>
</html>
